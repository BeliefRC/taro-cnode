(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{"142":function(e,t,n){},"151":function(e,t,n){"use strict";n.r(t);var r,o=n(0),c=n(1),a=n(156),i=n(148),s=n(137),u=n(132),p=n(155),l=n(52),f=n(12),h=n(42),b=(n(142),function(){function defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&defineProperties(e.prototype,t),n&&defineProperties(e,n),e}}()),d=function get(e,t,n){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,t);if(void 0===r){var o=Object.getPrototypeOf(e);return null===o?void 0:get(o,t,n)}if("value"in r)return r.value;var c=r.get;return void 0!==c?c.call(n):void 0},y=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e};function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var g=Object(f.b)(function(e){return y({},e.menu,e.user,{"topicInfo":e.topicList.topicInfo})})(r=function(e){function Publish(){var e,t,n;!function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,Publish);for(var r=arguments.length,o=Array(r),c=0;c<r;c++)o[c]=arguments[c];return t=n=_possibleConstructorReturn(this,(e=Publish.__proto__||Object.getPrototypeOf(Publish)).call.apply(e,[this].concat(o))),n.state={"selectCategory":null,"title":null,"content":null,"isEdit":!1},_possibleConstructorReturn(n,t)}return function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{"constructor":{"value":e,"enumerable":!1,"writable":!0,"configurable":!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(Publish,c["a"].Component),b(Publish,[{"key":"componentDidMount","value":function componentDidMount(){var e=this.$router.params.edit,t=this.props,n=t.topicInfo,r=t.categoryData,o=n?this.filterHTMLTag(n.content):"";this.setState({"isEdit":"1"===e,"topicInfo":n,"title":n?n.title:"","selectCategory":n?r.find(function(e){return e.key===n.tab}):null,"content":o})}},{"key":"filterHTMLTag","value":function filterHTMLTag(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return e=e.replace(/<\/?[^>]*>/g,"")}},{"key":"changeCategory","value":function changeCategory(e){var t=this.props.categoryData;this.setState({"selectCategory":t[e.detail.value]})}},{"key":"titleChange","value":function titleChange(e){this.setState({"title":e.target.value})}},{"key":"contentChange","value":function contentChange(e){this.setState({"content":e.target.value})}},{"key":"submitTopic","value":function submitTopic(){var e=this.state,t=e.title,n=e.content,r=e.selectCategory,o=e.isEdit,i=this.props,s=i.accesstoken,u=i.topicInfo;if(t&&n&&r){var p={"tab":r.key,"title":t,"content":n,"accesstoken":s,"topic_id":u.id};o?Object(h.f)(p).then(function(e){e&&c.a.navigateBack()}):Object(h.e)(p).then(function(e){e&&c.a.redirectTo({"url":"/pages/user/user"})})}else Object(a.c)({"title":"分类或者标题内容都不能为空!","icon":"none"})}},{"key":"render","value":function render(){var e=this.props.categoryData,t=this.state,n=t.selectCategory,r=t.topicInfo,c=t.isEdit;return o.c.createElement(i.a,{"className":"publish-topic"},o.c.createElement(s.a,{"type":"text","value":c&&r?r.title:"","className":"publish-topic-title","onInput":this.titleChange.bind(this),"placeholder":"请输入你要发布的标题"}),o.c.createElement(u.a,{"value":c&&r?this.filterHTMLTag(r.content):"","className":"publish-topic-content","onInput":this.contentChange.bind(this),"placeholder":"请输入您要发布的内容"}),o.c.createElement(p.a,{"onChange":this.changeCategory.bind(this),"mode":"selector","range":e,"rangeKey":"value"},o.c.createElement(i.a,{"className":"publish-topic-category"},n?n.value:"请选择")),o.c.createElement(l.a,{"className":"publish-topic-btn","onClick":this.submitTopic.bind(this)},"提交"))}},{"key":"componentDidShow","value":function componentDidShow(){d(Publish.prototype.__proto__||Object.getPrototypeOf(Publish.prototype),"componentDidShow",this)&&d(Publish.prototype.__proto__||Object.getPrototypeOf(Publish.prototype),"componentDidShow",this).call(this)}},{"key":"componentDidHide","value":function componentDidHide(){d(Publish.prototype.__proto__||Object.getPrototypeOf(Publish.prototype),"componentDidHide",this)&&d(Publish.prototype.__proto__||Object.getPrototypeOf(Publish.prototype),"componentDidHide",this).call(this)}}]),Publish}())||r;t.default=g},"33":function(e,t,n){"use strict";n.d(t,"a",function(){return getJSON}),n.d(t,"b",function(){return postJSON});var r=n(156),o=n(147);n(14);function getJSON(e,t){return Object(r.b)({"title":"请求中","mask":!0}),Object(o.a)({"url":e,"data":t,"method":"GET"}).then(function(e){return Object(r.a)(),e.data}).catch(function(e){console.error(e),Object(r.b)({"title":"请求失败"}),setTimeout(function(){Object(r.a)()},2e3)})}function postJSON(e,t){return Object(r.b)({"title":"请求中","mask":!0}),Object(o.a)({"header":{"content-type":"application/json"},"url":e,"data":t,"method":"POST"}).then(function(e){return Object(r.a)(),e.data}).catch(function(e){console.error(e),Object(r.b)({"title":"请求失败"}),setTimeout(function(){Object(r.a)()},2e4)})}},"34":function(e,t,n){"use strict";t.a={"getTopics":"https://cnodejs.org/api/v1/topics","getTopicInfo":"https://cnodejs.org/api/v1/topic","checkUserToken":"https://cnodejs.org/api/v1/accesstoken","getUserInfo":"https://cnodejs.org/api/v1/user/","createTopic":"https://cnodejs.org/api/v1/topics","replyTopic":"https://cnodejs.org/api/v1/topic/","upReply":"https://cnodejs.org/api/v1/reply/","updateTopic":"https://cnodejs.org/api/v1/topics/update"}},"42":function(e,t,n){"use strict";n.d(t,"c",function(){return i}),n.d(t,"b",function(){return getTopicInfo}),n.d(t,"a",function(){return f}),n.d(t,"d",function(){return h}),n.d(t,"e",function(){return b}),n.d(t,"f",function(){return d});var r=n(156),o=n(33),c=n(34),a=n(6);function _asyncToGenerator(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,n){return function step(r,o){try{var c=t[r](o),a=c.value}catch(e){return void n(e)}if(!c.done)return Promise.resolve(a).then(function(e){step("next",e)},function(e){step("throw",e)});e(a)}("next")})}}var i=function getTopicList(e){return t=_asyncToGenerator(regeneratorRuntime.mark(function _callee(t){var n;return regeneratorRuntime.wrap(function _callee$(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,Object(o.a)(c.a.getTopics,e);case 2:(n=r.sent)&&!0===n.success&&(e.page<=1?t({"type":a.d,"payload":{"list":n.data}}):n.data.length&&t({"type":a.b,"payload":{"list":n.data,"page":e.page}}));case 4:case"end":return r.stop()}},_callee,void 0)})),function(e){return t.apply(this,arguments)};var t};function getTopicInfo(e){var t,n=this;return t=_asyncToGenerator(regeneratorRuntime.mark(function _callee2(t){var r;return regeneratorRuntime.wrap(function _callee2$(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,Object(o.a)(c.a.getTopicInfo+"/"+e.topicId,e);case 2:(r=n.sent)&&r.success?t({"type":a.c,"payload":{"infoData":r.data}}):console.error("请求话题详情失败！");case 4:case"end":return n.stop()}},_callee2,n)})),function(e){return t.apply(this,arguments)}}var s,u,p,l,f=(s=_asyncToGenerator(regeneratorRuntime.mark(function _callee3(e){var t;return regeneratorRuntime.wrap(function _callee3$(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,Object(o.b)(c.a.upReply+e.replyId+"/ups",e);case 2:if(!(t=n.sent)||!t.success){n.next=7;break}return n.abrupt("return",t);case 7:Object(r.c)({"title":"点赞失败!","icon":"none"});case 8:return n.abrupt("return",!1);case 9:case"end":return n.stop()}},_callee3,this)})),function admireTopic(e){return s.apply(this,arguments)}),h=(u=_asyncToGenerator(regeneratorRuntime.mark(function _callee4(e){var t;return regeneratorRuntime.wrap(function _callee4$(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,Object(o.b)(c.a.replyTopic+e.topicid+"/replies",e);case 2:if(!(t=n.sent)||!t.success){n.next=7;break}return n.abrupt("return",t);case 7:Object(r.c)({"title":"评论失败!","icon":"none"});case 8:return n.abrupt("return",!1);case 9:case"end":return n.stop()}},_callee4,this)})),function replyContentValue(e){return u.apply(this,arguments)}),b=(p=_asyncToGenerator(regeneratorRuntime.mark(function _callee5(e){var t;return regeneratorRuntime.wrap(function _callee5$(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,Object(o.b)(c.a.createTopic,e);case 2:if(!(t=n.sent)||!t.success){n.next=7;break}return n.abrupt("return",t);case 7:Object(r.c)({"title":"发布话题失败!","icon":"none"});case 8:return n.abrupt("return",!1);case 9:case"end":return n.stop()}},_callee5,this)})),function submitTopic(e){return p.apply(this,arguments)}),d=(l=_asyncToGenerator(regeneratorRuntime.mark(function _callee6(e){var t;return regeneratorRuntime.wrap(function _callee6$(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,Object(o.b)(c.a.updateTopic,e);case 2:if(!(t=n.sent)||!t.success){n.next=7;break}return n.abrupt("return",t);case 7:Object(r.c)({"title":"更新话题失败!","icon":"none"});case 8:return n.abrupt("return",!1);case 9:case"end":return n.stop()}},_callee6,this)})),function updateTopic(e){return l.apply(this,arguments)})}}]);